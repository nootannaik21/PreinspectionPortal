<div class="row">
  <div class="col text-left">
    <h3>{{ title }}</h3>
  </div>
</div>
<div class="row">&nbsp;</div>
<div class="row">
  <div class="col-sm-12">
    <app-card [hidHeader]="true" [options]="false">
      <form [formGroup]="addInspectionForm" (ngSubmit)="createInspection()">
        <h5 *ngIf="showBranchDetail">Branch Details</h5>
        <span *ngIf="showBranchDetail"><hr /></span>
        <div class="row">
          <!--Branch Name-->
          <div class="col-md-6">
            <div class="form-group" *ngIf="showBranchDetail">
              <label for="exampleInputEmail1">Branch Name</label>
              <select
                class="form-control"
                formControlName="branchName"
                placeholder="Choose Branch Name"
                [(ngModel)]="inspectionData.branchName"
                tabindex="1"
                (change)="onBranchSelect()"
                [ngClass]="{ 'is-invalid': submitted && f.branchName.errors }"
                required
              >
                <option value="">Choose Branch Name</option>
                <option
                  class="form-control"
                  *ngFor="let item of branches"
                  [value]="item.branchName"
                >
                  <table>
                    <tr>
                      <td>{{ item.branchName }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.branchcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.branchName.errors.required">
                  Branch Name is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Branch Name-->
          <!--Branch Code-->
          <div class="col-md-6">
            <div class="form-group" *ngIf="showBranchDetail">
              <label for="exampleInputEmail1">Branch Code</label>
              <select
                class="form-control"
                formControlName="branchcode"
                placeholder="Choose Branch Code"
                [(ngModel)]="inspectionData.branchcode"
                tabindex="2"
                (change)="onBranchCodeSelect()"
                [ngClass]="{ 'is-invalid': submitted && f.branchcode.errors }"
                required
              >
                <option value="">Choose Branch Code</option>
                <option
                  class="form-control"
                  *ngFor="let item of branches"
                  [value]="item.branchCode"
                >
                  <table>
                    <tr>
                      <td>{{ item.branchCode }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.branchcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.branchcode.errors.required">
                  Branch Code is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Branch Code-->
        </div>
        <br />
        <h5>IMD Details</h5>
        <hr />
        <div class="row">
          <!--IMD Code-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleInputPassword1">IMD Code</label>
              <input
                type="text"
                class="form-control"
                placeholder="IMD Code"
                tabindex="3"
                formControlName="imdcode"
                [(ngModel)]="inspectionData.imdcode"
                required
                [ngClass]="{ 'is-invalid': submitted && f.imdcode.errors }"
              />
              <div
                *ngIf="submitted && f.imdcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.imdcode.errors.required">
                  IMD Code is required
                </div>
                <div *ngIf="f.imdcode.errors.pattern">
                  IMD Code should be 8 characters
                </div>
              </div>
            </div>
          </div>
          <!--End of IMD Code-->
          <!--IMD Email-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Email of IMD</label>
              <input
                type="text"
                class="form-control"
                formControlName="emailidofsales"
                placeholder="Email Id of Sales"
                [(ngModel)]="inspectionData.emailidofsales"
                tabindex="4"
                required
                [ngClass]="{
                  'is-invalid': submitted && f.emailidofsales.errors
                }"
              />
              <div
                *ngIf="submitted && f.emailidofsales.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.emailidofsales.errors.required">
                  Email of IMD is required
                </div>
                <div *ngIf="f.emailidofsales.errors.pattern">
                  Email must be a valid email address
                </div>
              </div>
            </div>
          </div>
          <!--End of IMD Email-->
          <!--IMD Phone #-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Phone no of IMD</label>
              <input
                type="email"
                class="form-control"
                placeholder="Phone no of IMD"
                required
                formControlName="phoneNoofsales"
                [(ngModel)]="inspectionData.phoneNoofsales"
                tabindex="5"
                [ngClass]="{
                  'is-invalid': submitted && f.phoneNoofsales.errors
                }"
              />
              <div
                *ngIf="submitted && f.phoneNoofsales.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.phoneNoofsales.errors.required">
                  Phone no of IMD/SM is required
                </div>
                <div *ngIf="f.phoneNoofsales.errors.pattern">
                  Please enter valid phone number.e.g:xxxxxxxxxx
                </div>
              </div>
            </div>
          </div>
          <!--End of IMD Phone #-->
        </div>
        <br />
        <h5>Customer Details</h5>
        <hr />
        <div class="row">
          <!--Customer Name-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Customer Name</label>
              <input
                type="text"
                class="form-control"
                placeholder="Customer Name"
                required
                formControlName="clientname"
                tabindex="6"
                [(ngModel)]="inspectionData.clientname"
                appOnlyalphabets
                [onlyAlpha]="true"
                [ngClass]="{ 'is-invalid': submitted && f.clientname.errors }"
              />
              <div
                *ngIf="submitted && f.clientname.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.clientname.errors.required">
                  Customer Name is required
                </div>
                <div *ngIf="f.clientname.errors.pattern">
                  Customer Name should not exceed 20 characters
                </div>
              </div>
            </div>
          </div>
          <!--End of Customer Name-->
          <!--Customer Email ID-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Customer Email Id</label>
              <input
                type="email"
                class="form-control"
                placeholder="Customer Email Id"
                formControlName="clientemail"
                tabindex="7"
                [(ngModel)]="inspectionData.clientemail"
                required
                [ngClass]="{ 'is-invalid': submitted && f.clientemail.errors }"
              />
              <div
                *ngIf="submitted && f.clientemail.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.clientemail.errors.required">
                  Customer Email is required
                </div>
                <div *ngIf="f.clientemail.errors.pattern">
                  Email must be a valid email address
                </div>
              </div>
            </div>
          </div>
          <!--End of Customer Email ID-->
          <!--Customer Mobile #-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Customer Mobile Number</label>
              <input
                type="text"
                class="form-control"
                placeholder="Client Mobile Number"
                formControlName="clientphoneno"
                tabindex="8"
                [(ngModel)]="inspectionData.clientphoneno"
                OnlyNumber
                [onlyNumber]="true"
                required
                [ngClass]="{
                  'is-invalid': submitted && f.clientphoneno.errors
                }"
              />
              <div
                *ngIf="submitted && f.clientphoneno.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.clientphoneno.errors.required">
                  Customer Mobile Number is required
                </div>
                <div *ngIf="f.clientphoneno.errors.pattern">
                  Please enter valid Mobile number.e.g:xxxxxxxxxx
                </div>
              </div>
            </div>
          </div>
          <!--End of Customer Mobile #-->
          <!--Customer Alternate Phone #-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Alternate Phone Number</label>
              <input
                type="text"
                class="form-control"
                placeholder="Alternate Phone Number"
                OnlyNumber
                [onlyNumber]="true"
                formControlName="clientalternatephoneno"
                tabindex="9"
                [(ngModel)]="inspectionData.clientalternatephoneno"
                required
                [ngClass]="{
                  'is-invalid': submitted && f.clientalternatephoneno.errors
                }"
              />
              <div
                *ngIf="submitted && f.clientalternatephoneno.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.clientalternatephoneno.errors.required">
                  Alternate Phone No is required
                </div>
                <div *ngIf="f.clientalternatephoneno.errors.pattern">
                  Please enter valid phone number.e.g:xxxxxxxxxx
                </div>
              </div>
            </div>
          </div>
          <!--Customer Alternate Phone #-->
        </div>
        <br />
        <h5>Product Details</h5>
        <hr />
        <div class="row">
          <!--Product Type-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleInputEmail1">Product Type</label>
              <select
                class="form-control"
                formControlName="productType"
                placeholder="Product Type"
                [(ngModel)]="inspectionData.productType"
                tabindex="10"
                [ngClass]="{ 'is-invalid': submitted && f.productType.errors }"
                required
              >
                <option value="">Choose Product Type</option>
                <option
                  class="form-control"
                  *ngFor="let item of productTypes"
                  [value]="item.type"
                >
                  <table>
                    <tr>
                      <td>{{ item.type }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.branchcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.productType.errors.required">
                  Product Type is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Product Type-->
          <!--Vechile Reg #-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleFormControlSelect1"
                >Vehicle Registration Number</label
              >
              <input
                type="text"
                class="form-control"
                placeholder="Registration Number"
                formControlName="registrationno"
                tabindex="11"
                [(ngModel)]="inspectionData.registrationno"
                required
                [ngClass]="{
                  'is-invalid': submitted && f.registrationno.errors
                }"
                
              />
              <div
                *ngIf="submitted && f.registrationno.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.registrationno.errors.required">
                  Vehicle Reg. No. is required
                </div>
                <div *ngIf="f.registrationno.errors.pattern">
                Please enter correct Vehicle Reg. No.
                </div>
              </div>
            </div>
          </div>
          <!--End of Vechile Reg #-->
          <!--Make of Vechile-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Make of Vehicle</label>
              <input
                type="text"
                class="form-control"
                placeholder="Make of Vehicle"
                formControlName="make"
                tabindex="12"
                [(ngModel)]="inspectionData.make"
                required
                appOnlyalphabets
                [onlyAlpha]="true"
                [ngClass]="{ 'is-invalid': submitted && f.make.errors }"
              />
              <div *ngIf="submitted && f.make.errors" class="invalid-feedback">
                <div *ngIf="f.make.errors.required">Make is required</div>
              </div>
            </div>
          </div>
          <!--End of Make of Vechile-->
          <!--Model-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleFormControlSelect1">Model</label>
              <input
                type="text"
                class="form-control"
                placeholder="Model"
                formControlName="model"
                tabindex="13"
                [(ngModel)]="inspectionData.model"
                required
                [ngClass]="{ 'is-invalid': submitted && f.model.errors }"
              />
              <div *ngIf="submitted && f.model.errors" class="invalid-feedback">
                <div *ngIf="f.model.errors.required">Model is required</div>
                <div *ngIf="f.model.errors.pattern">
                  Please enter valid format. Model format e.g:xxxx 2010
                  <fieldset></fieldset>
                </div>
              </div>
            </div>
          </div>
          <!--End of Model-->
          <!--Conveyance-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Conveyance</label>
              <select
                class="form-control"
                formControlName="convayance"
                placeholder="Convayance"
                [(ngModel)]="inspectionData.convayance"
                tabindex="14"
                [ngClass]="{ 'is-invalid': submitted && f.convayance.errors }"
                required
              >
                <option value="">Choose Conveyance</option>
                <option
                  class="form-control"
                  *ngFor="let item of convayances"
                  [value]="item.convayance"
                >
                  <table>
                    <tr>
                      <td>{{ item.convayance }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.branchcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.convayance.errors.required">
                  Conveyance is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Conveyance-->
          <!--Conveyance in KM-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleFormControlSelect1">Conveyance in KM</label>
              <input
                type="text"
                class="form-control"
                placeholder="Conveyance in KM"
                OnlyNumber
                [onlyNumber]="true"
                formControlName="conveyanceKm"
                tabindex="15"
                [(ngModel)]="inspectionData.conveyanceKm"
                [ngClass]="{ 'is-invalid': submitted && f.conveyanceKm.errors }"
                required
              />
              <div
                *ngIf="submitted && f.conveyanceKm.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.conveyanceKm.errors.required">
                  Conveyance is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Conveyance in KM-->
        </div>
        <br />
        <h5>Inspection Criteria</h5>
        <hr />
        <div class="row">
          <!--Reason for Inspection-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleInputEmail1">Reason for Inspection</label>
              <select
                class="form-control"
                formControlName="inspectionreason"
                placeholder="Inspection Reasons"
                [(ngModel)]="inspectionData.inspectionreason"
                tabindex="16"
                [ngClass]="{
                  'is-invalid': submitted && f.inspectionreason.errors
                }"
                required
              >
                <option value="">Choose Reason for Inspection</option>
                <option
                  class="form-control"
                  *ngFor="let item of inspectionreasons"
                  [value]="item.reason"
                >
                  <table>
                    <tr>
                      <td>{{ item.reason }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.branchcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.inspectionreason.errors.required">
                  Inspection Reason is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Reason for Inspection-->
          <!--Risk Type-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleInputEmail1">Risk Type</label>
              <select
                class="form-control"
                formControlName="riskType"
                placeholder="Risk Type"
                [(ngModel)]="inspectionData.riskType"
                tabindex="17"
                [ngClass]="{ 'is-invalid': submitted && f.riskType.errors }"
                required
              >
                <option value="">Choose Risk Type</option>
                <option
                  class="form-control"
                  *ngFor="let item of riskTypes"
                  [value]="item.type"
                >
                  <table>
                    <tr>
                      <td>{{ item.type }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.branchcode.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.riskType.errors.required">
                  Risk Type is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Risk Type-->
          <!--Duplicate Inspection-->
          <div class="col-md-6">
            <div class="form-group">
              <label class="">Duplicate Inspection</label>
              <select
                class="form-control"
                id="id"
                formControlName="duplicateinspection"
                [(ngModel)]="inspectionData.duplicateinspection"
                tabindex="18"
                (change)="onDuplicateInspection($event)"
              >
                <option value="no" selected>No</option>
                <option value="yes">Yes</option>
            </select>
              <div
                *ngIf="submitted && f.duplicateinspection.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.duplicateinspection.errors.required">
                  Duplicate Inspection is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Duplicate Inspection-->
          <!--Payment Mode-->
          <div class="col-md-6">
            <div class="form-group">
              <label for="exampleFormControlSelect1">Payment Type</label>
              <select
                class="form-control"
                id="paymentid"
                formControlName="paymentmodeid"
                [(ngModel)]="inspectionData.paymentmodeid"
                tabindex="19"
                [ngClass]="{
                  'is-invalid': submitted && f.paymentmodeid.errors
                }"
                required
              >
                <option value="">Choose Payment Type</option>
                <option
                  class="form-control"
                  *ngFor="let item of paymentMode"
                  [value]="item.id"
                >
                  <table>
                    <tr>
                      <td>{{ item.name }}</td>
                    </tr>
                  </table>
                </option>
              </select>
              <div
                *ngIf="submitted && f.paymentmodeid.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.paymentmodeid.errors.required">
                  Payment Mode is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Payment Mode-->
          <!--Location of Inspection-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Location of Inspection</label>
              <input
                type="text"
                class="form-control"
                placeholder="Location of Inspection"
                formControlName="inspectionlocation"
                tabindex="20"
                appOnlyalphabets
                [onlyAlpha]="true"
                [(ngModel)]="inspectionData.inspectionlocation"
                required
                [ngClass]="{
                  'is-invalid': submitted && f.inspectionlocation.errors
                }"
              />
              <div
                *ngIf="submitted && f.inspectionlocation.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.inspectionlocation.errors.required">
                  Location of Inspection is required
                </div>
              </div>
            </div>
          </div>
          <!--End of Location of Inspection-->
          <!--Vendor Email ID-->
          <div class="col-md-6">
            <div class="form-group">
              <label>Vendor</label>
              <select
                class="form-control"
                formControlName="vendorEmailId"
                placeholder="Choose Vendor EmailId"
                [(ngModel)]="inspectionData.vendorOrganization"
                tabindex="21"
              >
                <option value="">Choose Vendor</option>
                <option
                  class="form-control"
                  *ngFor="let item of vendorEmailIdDetails"
                  [value]="item.inspectionemail"
                >
                  <table>
                    <tr>
                      <td>{{ item.vendorname }}({{item.inspectionemail}})</td>
                    </tr>
                  </table>
                </option>
              </select>
            </div>
          </div>
          <!--End of Vendor Email ID-->
          <!--Remarks-->
          <div class="col-md-12">
            <div class="form-group">
              <label for="exampleFormControlSelect1">Remarks</label>
              <textarea
                type="text-center"
                class="form-control form-control-sm"
                rows="2"
                formControlName="remarks"
                [(ngModel)]="inspectionData.remarks"
                placeholder="Remarks"
                tabindex="22"
                [ngClass]="{ 'is-invalid': submitted && f.remarks.errors }"
              ></textarea>
              <div
                *ngIf="submitted && f.remarks.errors"
                class="invalid-feedback"
              >
                <div *ngIf="f.remarks.errors.required">Remarks is required</div>
              </div>
            </div>
          </div>
          <!--End of Remarks-->
          <!--Status-->
          <div class="col-md-6">
            <div class="form-group" *ngIf="hideStatus">
              <label>Status</label>
              <select
                class="form-control"
                id="id"
                formControlName="statusid"
                [(ngModel)]="inspectionData.statusid"
                tabindex="23"
                (change)="statusChanged($event)"
              >
                <option value="">Choose Status</option>
                <option
                  class="form-control"
                  *ngFor="let item of status"
                  [value]="item.id"
                >
                  <table>
                    <tr>
                      <td>{{ item.name }}</td>
                    </tr>
                  </table>
                </option>
              </select>
            </div>
          </div>
          <!--End of Status-->
          <!--Upload Documents-->
          <div class="col-md-6" *ngIf="showUpload">
            <div class="form-group">
              <input
                type="file"
                id="file"
                accept=".pdf,.png,.JPEG,.jpeg,.JPG,.jpg"
                multiple
                (change)="getFileDetails($event)"
              />
              <button (click)="uploadFiles($event.target.files)" type="button">
                Upload Documents
              </button>
            </div>
            <div *ngFor="let file of myFiles">
              <div>* {{ file.name }} - {{ file.type }} - {{ file.size }}</div>
            </div>
          </div>
          <!--End of Upload Documents-->
        </div>
        <!--Form Buttons-->
        <div class="row text-right">
          <div class="col-12">
            <button
              type="button"
              class="btn btn-secondary mr-1"
              (click)="cancel()"
            >
              Cancel
            </button>
            <button
              type="button"
              *ngIf="disableInspection"
              class="btn btn-primary"
              (click)="updateInspection()"
            >
              Update Inspection
            </button>
            <button
              type="submit"
              *ngIf="inspectionData.id == undefined && !disableInspection"
              class="btn btn-primary"
            >
              Create Inspection
            </button>
          </div>
        </div>
        <!--End of Form Buttons-->
      </form>
    </app-card>
    <br />
    <!--Inspection History-->
    <div class="row" *ngIf="showHistoryTable">
      <div class="col text-left">
        <h3>Inspection History</h3>
      </div>
      <div class="col-sm-12">
        <app-card [hidHeader]="true" [options]="false">
          <div class="table">
            <table
              datatable
              [dtOptions]="dtOptions"
              [dtTrigger]="dtTrigger"
              class="table table-striped table-bordered table-hover shrink-table-cell"
            >
              <thead>
                <tr>
                  <th class="text-left" style="width: 10%">Status</th>
                  <th class="text-left" style="width: 10%">Updated By</th>
                  <th class="text-left" style="width: 10%">Date</th>
                  <th class="text-left" style="width: 70%">Remarks</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of inspectionHistory">
                  <td class="text-left">
                    {{
                      item.statusid == 1
                        ? "Recommended"
                        : item.statusid == 2
                        ? "Not Recommended"
                        : item.statusid == 3
                        ? "Rescheduled"
                        : item.statusid == 4
                        ? "Cancelled"
                        : item.statusid == 5
                        ? "Appointmant Fix"
                        : "Request Raised"
                    }}
                  </td>
                  <td class="text-left">
                    {{ item.modifiedBy }}
                  </td>
                  <td class="text-left">
                    {{ item.modifiedDate | date: "dd/MM/yyyy" }}
                  </td>
                  <td class="text-left">
                    {{ item.remarks }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </app-card>
      </div>
    </div>
  </div>
</div>
